# Reverse Engineering Notes: TikTok Shop

## Key Components

### 1. Request Signing (X-Bogus & X-Gnarly)
To successfully make requests to TikTok's internal APIs (including Shop endpoints), specific headers are required to prove the request is from a legitimate client.

*   **X-Bogus**: A short signature string (e.g., `DFSzKwVLHZiAN9bhCt3W4XpP1dmT`).
    *   Appears to be generated based on the URL query parameters and body.
    *   Older versions (VerifyFp) are largely deprecated for critical endpoints.
*   **X-Gnarly**: A longer, more complex signature string.
    *   Often accompanies X-Bogus in newer API versions.
    *   Critical for "Shop" related endpoints which have higher security.
*   **User-Agent**: Must match the environment used to generate the signatures.

### 2. Protobuf (Protocol Buffers)
Many TikTok Shop responses (and some requests) are encoded in Protobuf rather than JSON.
*   **Structure Validation**: Field order and types must be exact.
*   **Hashing**: `SM3` cryptographic hash function is often used on query/body before Protobuf serialization.
*   **Tools**: Use `protoc` to decode raw binary responses to find the schema.

### 3. Open Source References
*   `justbeluga/tiktok-web-reverse-engineering`: Demonstrates a headless browser approach to generating signatures. This is "safer" but slower than pure algorithmic generation.
*   `int4444/tiktok-api`: Mentions SM3 hashing and strict Protobuf field ordering.

## Strategy for "Spy" Tool
1.  **Hybrid Approach**: Use a lightweight Node.js service (using Puppeteer/Playwright or a ported algorithm) to generate signatures (`X-Bogus`, `X-Gnarly`).
2.  **Python Core**: Use Python `requests` to send the actual API calls, injecting the signatures generated by the Node.js service.
3.  **Protobuf Decoding**: Save response bodies to `.bin` files and use `protoc --decode_raw` to inspect structure, then build `.proto` definitions.
